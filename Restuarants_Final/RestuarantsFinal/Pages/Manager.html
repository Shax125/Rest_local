<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">
    <script src="../Scripts/jquery-3.4.1.min.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <title></title>
    <script>
        var campain;


        $(document).ready(function () {

            getcampain();

            $('#viewandedit').submit(f2);
            

        });
        function f2() {
            console.log('on f2');
            return false;
        }

        function getcampain() {
            ajaxCall("GET", "/api/Campaign", "", getSuccess, error);
        }

        $(document).on("click", ".deleteBtn", function () {
            //markSelected(this);
            var campaingId = this.getAttribute('data-campainId');
            swal({ // this will open a dialouge 
                title: "Are you sure ??",
                text: "",
                icon: "warning",
                buttons: true,
                dangerMode: true
            })
                .then(function (willDelete) {
                    if (willDelete) Deletecampain(campaingId);
                    else swal("Not Deleted!");
                });
        });

        $(document).on("click", ".viewBtn", function () {
            //markSelected(this);
            var campaignId = this.getAttribute('data-campainId');
            console.log(campain);
            str1 = "";
            console.log("obj: ", campain[campaignId])
            $("#restuarantPH").text("");
            str1 += "<form id='viewandedit'>"
            str1 +=   "<label for='id'> ID: </label >";
            str1 += "<input type='text' id='id' name='id' disabled value='" + campain[campaignId].Id +"'/><br><br>";
            str1 += "<label for='budget'> Budget: </label > ";
            str1 += "<input type='text' id='budget' name='budget' value='" + campain[campaignId].Budjet + "'/><br><br>";
            str1 += "<label for='balance'> Balance: </label > ";
            str1 += "<input type='text' id='balance' name='balance' disabled value='" + campain[campaignId].Balance + "'/><br><br>";
            str1 += "<label for='clickCounter'> Click Counter: </label > ";
            str1 += "<input type='text' id='clickCounter' name='clickCounter' disabled value='" + campain[campaignId].Clickcounter + "'/><br><br>";
            str1 += "<label for='viewcounter'> view counter: </label > ";
            str1 += "<input type='text' id='viewcounter' name='viewcounter' disabled value='" + campain[campaignId].Viewcounter + "'/><br><br>" 
            str1 += "<label for= 'idr'> Id Restaurant: </label > ";
            str1 += "<input type='text' id='idr' name='idr' disabled value='" + campain[campaignId].IdR + "'/><br><br>"
            str1 += "<input type='submit' value='Submit'> </form>";

            $("#restuarantPH").append(str1);

        });


        function Deletecampain(id) {
            
          
            ajaxCall("PUT", "/api/Campaign/" + id, "", deleteSuccess, deleterror);
        }
        function deleteSuccess(campaindata) {
            //tbl.clear();
            $("#tbody1").text(" ");
            getcampain();
            //redrawTable(tbl, campaindata);
            //buttonEvents(); // after redrawing the table, we must wire the new buttons
            //$("#editDiv").hide();
            swal("Deleted Successfuly!", "Great Job", "success");
        }
        function deleterror(err) {
            swal("Error: " + err);
        }
       

        function getSuccess(campaindata) {

            campain = campaindata; // keep the cars array in a global variable;
            //try {
            //    tbl = $('#campainTable').DataTable({
            //        data: campain,
            //        pageLength: 5,
            //        columns: [
            //            {
            //                render: function (data, type, row, meta) {
            //                    let datacampain = "data-CampainId='" + row.Id + "'";

            //                    editBtn = "<button type='button' class = 'editBtn btn btn-success' " + datacampain + "> Edit </button>";
            //                    viewBtn = "<button type='button' class = 'viewBtn btn btn-info' " + datacampain + "> View </button>";
            //                    deleteBtn = "<button type='button' class = 'deleteBtn btn btn-danger' " + datacampain + "> Delete </button>";
            //                    return editBtn + viewBtn + deleteBtn;
            //                }
            //            },
            //            { data: "Id" },
            //            { data: "Budjet" },
            //            { data: "Balance" },
            //            { data: "ClickCounter" },
            //            { data: "ViewCounter" },
            //            { data: "Status" },
                    
            //        ],
            //    });
            //    // buttonEvents();
            //}

            //catch (err) {
            //    alert(err);
            //}
            str=""
            for (var i = 0; i < campaindata.length; i++) { 

                str += "<tr role='row' class='odd'>";
                str += '<td class="sorting_1">';
                str += '<button type="button" class="editBtn btn btn-success" data-CampainId="' + campaindata[i].Id + '"> Edit </button>';
                str += '<button type="button" class="viewBtn btn btn-info" data-CampainId="' + campaindata[i].Id + '"> View </button>';
                str += '<button type="button" class="deleteBtn btn btn-danger" data-CampainId="' + campaindata[i].Id + '"> Delete </button>';
                str += '</td>';
                str += ' <td>' + campaindata[i].Id + '</td>';
                str += ' <td>' + campaindata[i].Budjet +'</td>';
                str += ' <td>' + campaindata[i].Balance +'</td>';
                str += ' <td>' + campaindata[i].Clickcounter +'</td>';
                str += ' <td>' + campaindata[i].Viewcounter +'</td>';
                str += ' <td>' + campaindata[i].Status +'</td>'; 
                str += ' </tr>';
                
            }

            $("#tbody1").append(str);
        }

        function error(err) {
            swal("Error: " + err);
        }





    </script>
</head>
<body>



    <div>


        <form id="pForm">
            <div id="campainTable_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                <!--<div class="row">
            <div class="col-sm-6">
                <div class="dataTables_length" id="carsTable_length">
                <label>Show
                    <select name="carsTable_length" aria-controls="campainTable" class="form-control input-sm">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                     </select>
                    entries</label></div></div>
            <div class="col-sm-6"><div id="carsTable_filter" class="dataTables_filter">
                <label>Search:<input type="search" class="form-control input-sm" placeholder="" aria-controls="carsTable"></label>
                 </div></div></div>-->
                <div class="row">
                    <div class="col-sm-12">
                        <table id="campainTable" class="display nowrap dataTable no-footer" style="width: 100%;" role="grid" aria-describedby="campainTable_info">
                            <thead>
                                <tr role="row">
                                    <th class="sorting_asc" tabindex="0" aria-controls="campainTable" rowspan="1" colspan="1" aria-sort="ascending" aria-label=": activate to sort column descending" style="width: 175px;"></th>
                                    <th class="sorting" tabindex="0" aria-controls="campainTable" rowspan="1" colspan="1" aria-label="Id: activate to sort column ascending" style="width: 13px;">Id</th>
                                    <th class="sorting" tabindex="0" aria-controls="campainTable" rowspan="1" colspan="1" aria-label="Manufacturer: activate to sort column ascending" style="width: 89px;">Budjet</th>
                                    <th class="sorting" tabindex="0" aria-controls="campainTable" rowspan="1" colspan="1" aria-label="Model: activate to sort column ascending" style="width: 41px;">Balance</th>
                                    <th class="sorting" tabindex="0" aria-controls="campainTable" rowspan="1" colspan="1" aria-label="Year: activate to sort column ascending" style="width: 30px;">ClickCounter</th>
                                    <th class="sorting" tabindex="0" aria-controls="campainTable" rowspan="1" colspan="1" aria-label="Price: activate to sort column ascending" style="width: 35px;">ViewCounter</th>
                                    <th class="sorting" tabindex="0" aria-controls="campainTable" rowspan="1" colspan="1" aria-label="Color: activate to sort column ascending" style="width: 37px;">Status</th>
                                </tr>
                            </thead>
                            <tbody id="tbody1">
                            </tbody>
                        </table>
                    </div>
                </div>
                


                <div class="row">
                    <div class="col-sm-5">
                        <div class="dataTables_info" id="campainTable_info" role="status" aria-live="polite">
                            Showing 1 to 5 of 6 entries
                        </div>
                    </div><div class="col-sm-7"><div class="dataTables_paginate paging_simple_numbers" id="campainTable_paginate"><ul class="pagination"><li class="paginate_button previous disabled" id="campainTable_previous"><a href="#" aria-controls="campainTable" data-dt-idx="0" tabindex="0">Previous</a></li><li class="paginate_button active"><a href="#" aria-controls="campainTable" data-dt-idx="1" tabindex="0">1</a></li><li class="paginate_button "><a href="#" aria-controls="campainTable" data-dt-idx="2" tabindex="0">2</a></li><li class="paginate_button next" id="campainTable_next"><a href="#" aria-controls="campainTable" data-dt-idx="3" tabindex="0">Next</a></li></ul></div></div>
                </div>
            </div>





        </form>
        <div id="restuarantPH">



        </div>



    </div>

</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">
    <script src="../Scripts/jquery-3.4.1.min.js"></script>
    <script src="../Scripts/ajaxCalls.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link href="Main.css" rel="stylesheet" />
    <title></title>
    <script>
        var campain;


        $(document).ready(function ()
        {

            getcampain();
            getRestaurantsWithoutCampaign();


            $("#viewandedit").submit(function (e) {
                e.preventDefault();
                middle();
            });


            

        });

        $(document).on("click", ".deleteBtn", function () {
            //markSelected(this);
            var campaingId = this.getAttribute('data-campainId');
            swal({ // this will open a dialouge
                title: "Are you sure ??",
                text: "",
                icon: "warning",
                buttons: true,
                dangerMode: true
            })
                .then(function (willDelete) {
                    if (willDelete) Deletecampain(campaingId);
                    else swal("Not Deleted!");
                });
        });

        $(document).on("click", ".viewBtn", function () {
            //markSelected(this);
            var campaignId = this.getAttribute('data-campainId');
            console.log("in View: ", campain);
            str1 = "";
            console.log("obj: ", campain[campaignId])
            var c;
            $("#restuarantPH").toggle();
            for (var i = 0; i < campain.length; i++) {
                if (campain[i].Id == campaignId)
                    c = i
            }
            $("#restuarantPH").text("");
            str1 += "<form id='viewandedit'>"
            str1 += "<label for='id'> ID: </label >";
            str1 += "<input type='text' id='id' name='id' disabled value='" + campain[c].Id + "'/><br><br>";
            str1 += "<label for='budget'> Budget: </label > ";
            str1 += "<input type='text' id='budget' name='budget' value='" + campain[c].Budjet + "'/><br><br>";
            str1 += "<label for='balance'> Balance: </label > ";
            str1 += "<input type='text' id='balance' name='balance' disabled value='" + campain[c].Balance + "'/><br><br>";
            str1 += "<label for='clickCounter'> Click Counter: </label > ";
            str1 += "<input type='text' id='clickCounter' name='clickCounter' disabled value='" + campain[c].Clickcounter + "'/><br><br>";
            str1 += "<label for='viewcounter'> view counter: </label > ";
            str1 += "<input type='text' id='viewcounter' name='viewcounter' disabled value='" + campain[c].Viewcounter + "'/><br><br>"
            str1 += "<label for= 'idr'> Id Restaurant: </label > ";
            str1 += "<input type='text' id='idr' name='idr' disabled value='" + campain[c].IdR + "'/><br><br>"
            str1 += "<input type='submit' value='Submit'> </form>";

            $("#restuarantPH").html(str1);


        });

        function getRestaurantsWithoutCampaign() { //will get the resturants to the "select-option"
            ajaxCall("GET", "/api/Business", "", getSuccessrest, errorrest);

        }

        function getSuccessrest(data) {


            $('#Addcampaign').click(addnewcampaign(data))
        }

        function errorrest(ex) {
            console.log(ex);
        }

        function addnewcampaign(data) {
           
            $("#addrestuarantPH").show();


            formbuilder = "";
            formbuilder += '<form id="dropdownrestaurants"> <label for="rest">Choose a restaurant ID:</label> <select name="rest" id="rest"> ';
            for (var i = 0; i < data.length; i++)
            {
                formbuilder += ' <option id="' + data[i].Id + '">' + data[i].Id + '</option> '
            }
            formbuilder += ' </select> </br></br><label for="budget">Budget: </label>    <input type="text" id="budgetid" name="budget"> </form> </br> <button onclick="submitnewcampaign()" id="submitcampaign"> Submit new campaign </button> ';

            $("#addrestuarantPH").html(formbuilder);
        }

        function submitnewcampaign() {

            var budg = $("#budgetid").val();
            var rest = $("#rest").val();

            console.log("budgetid ", budg);
            console.log("restid ", rest);

            let newcampaign = {
                Idr: rest,
                Budjet: budg //why we wrote it with j ?!?!?!!? fucking j !!! 
            }

            ajaxCall("POST", "/api/Campaign", JSON.stringify(newcampaign), PostSuccessCampaign, PostErrorCampaign)

        }

        function PostSuccessCampaign(){
            console.log("InSuccess");
            location.reload();
            return false;
        }

        function PostErrorCampaign(ex) {
            console.log(ex);
        }

        function getcampain() {
            ajaxCall("GET", "/api/Campaign", "", getSuccess, error);
        }

        function Deletecampain(id) {

            ajaxCall("PUT", "/api/Campaign/" + id, "", deleteSuccess, deleterror);
        }

        function deleteSuccess(campaindata) {
            //tbl.clear();
            $("#tbody1").text(" ");
            getcampain();
            //redrawTable(tbl, campaindata);
            //buttonEvents(); // after redrawing the table, we must wire the new buttons
            //$("#editDiv").hide();
            swal("Deleted Successfuly!", "Great Job", "success");
        }

        function deleterror(err) {
            swal("Error: " + err);
        }

        function getSuccess(campaindata) {
            console.log(campaindata);


          
        }

        function error(err) {
            swal("Error: " + err);
        }



    </script>
</head>
<body>



    

                    
    
                    

        <!--<button id="Addcampaign">Add new campaign</button>-->

        <div id="restuarantPH">
            <br/>
            <hr style="border:0.5px solid gray" />
        </div>
        <div id="addrestuarantPH">
        </div>


   


</body>
</html>